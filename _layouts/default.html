<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		{% if page.collectionpage %}
			{% assign collectiondata = site.collections | where: "label", page.collectionpage | first %}
			<title>{{ collectiondata.title }} · {{ site.title }}</title>
		{% elsif page.title %}
			<title>{{ page.title }} · {{ site.title }}</title>
		{% else %}
			<title>{{ site.title }}</title>
		{% endif %}

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Jersey+10&display=swap" rel="stylesheet">

		<link rel="stylesheet" href="{{ '/assets/styles.css' | relative_url }}">

		{% if site.favicon %}
			<link rel="icon" type="image/png" sizes="32x32" href="{{ site.favicon }}">
		{% endif %}

		<script>
			// Theme handling - run immediately to prevent flash
			(function() {
				function getPreferredTheme() {
					const saved = localStorage.getItem('theme');
					if (saved) return saved;
					return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
				}
				document.documentElement.setAttribute('data-theme', getPreferredTheme());
			})();
		</script>
	</head>
	<body>

		<button class="theme-toggle" aria-label="Toggle dark mode">
			<img class="sun" src="{{ '/assets/sun.png' | relative_url }}" alt="Light mode">
			<img class="moon" src="{{ '/assets/moon.png' | relative_url }}" alt="Dark mode">
		</button>

		{{ content }}

		<script>
			// Theme toggle
			const themeToggle = document.querySelector('.theme-toggle');

			function setTheme(theme) {
				document.documentElement.setAttribute('data-theme', theme);
				localStorage.setItem('theme', theme);
			}

			window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
				if (!localStorage.getItem('theme')) {
					setTheme(e.matches ? 'dark' : 'light');
				}
			});

			themeToggle.addEventListener('click', () => {
				const current = document.documentElement.getAttribute('data-theme');
				setTheme(current === 'dark' ? 'light' : 'dark');
			});
		</script>
		<!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "0db9f099e49c488eaca767a6ce19a02b"}'></script><!-- End Cloudflare Web Analytics -->
	</body>
</html>
